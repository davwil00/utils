<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jumble</title>
    <style>
        .letter-container {
            display: flex;
            justify-content: center;
            font-size: 8em;
            gap: 1em;
            font-family: monospace;
            flex-wrap: wrap;
            /*max-width: 650px;*/
            margin: 1em auto 0;
            text-transform: uppercase;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="./jumble-words.js"></script>
    <script>
        function shuffle(anagram) {
            return anagram.split("")
                .filter(char => char !== " ")
                .map(value => ({ value, sort: Math.random() }))
                .sort((a, b) => a.sort - b.sort)
                .map(({ value }) => value);
        }

        function findWordMatchingPattern() {
            const pattern = document.getElementById("pattern").value;
            const regex = RegExp(`^${pattern}$`);
            const wordList = document.getElementById("word-list");
            wordList.innerHTML = "";
            dict.filter(word => regex.test(word))
                .map(word => {
                    const li = document.createElement("li");
                    li.innerText = word;
                    wordList.append(li);
                });
        }

        function generateJumble() {
            const anagram = document.getElementById("anagram").value;
            if (!anagram) {
                return;
            }
            const pattern = new RegExp(document.getElementById("pattern").value);
            let shuffled;
            do {
                shuffled = shuffle(anagram);
            } while (!pattern.test(shuffled.join("")));
            const containerElt = document.getElementById("container");
            containerElt.innerHTML = "";
            const format = document.getElementById("format").value.split("").map(it => parseInt(it));
            if (format.length > 0 && format.reduce((acc, curr) => acc + curr, 0) === shuffled.length) {
                format.forEach(length => {
                    const div = document.createElement("div");
                    div.classList.add("letter-container");
                    for (let i = 0; i < length; i++) {
                        const letter = shuffled.pop();
                        const span = document.createElement("span");
                        span.innerText = letter;
                        div.append(span);
                    }
                    containerElt.append(div);
                });
            } else {
                const div = document.createElement("div");
                div.classList.add("letter-container");
                shuffled.forEach(letter => {
                    const span = document.createElement("span");
                    span.innerText = letter;
                    div.append(span);
                });
                containerElt.append(div);
            }
        }

        function check() {
            const anagram = new Set(document.getElementById("anagram").value.toLowerCase().split(""));
            const removeElt = document.getElementById("remove");
            const lettersToCheck = new Set(removeElt.value.toLowerCase().split(""));
            if (anagram.size === lettersToCheck.size && [...anagram].every((x) => lettersToCheck.has(x))) {
                removeElt.style.color = "green";
            } else {
                removeElt.style.color = "red";
            }
        }

        function removeLetters() {
            const anagramElt = document.getElementById("anagram");
            const anagram = anagramElt.value.toLowerCase().split("");
            const removeElt = document.getElementById("remove");
            const lettersToRemove = removeElt.value.toLowerCase().split("");
            for (const letter of lettersToRemove) {
                const index = anagram.indexOf(letter);
                if (index >= 0) {
                    anagram.splice(index, 1);
                } else {
                    removeElt.style.color = "red";
                    return;
                }
            }

            removeElt.style.color = "black";
            anagramElt.value = anagram.join("");
            generateJumble();
        }
    </script>
</head>
<body>
<div class="form-floating col-sm-3 mb-3">
    <input type="text" id="anagram" class="form-control" />
    <label for="anagram">Letters</label>
</div>
<div class="form-floating col-sm-3 mb-3">
    <input type="text" id="pattern" class="form-control" />
    <label for="pattern">Pattern</label>
</div>
<div class="form-floating col-sm-3 mb-3">
    <input type="text" id="remove" class="form-control" />
    <label for="remove">Remove</label>
</div>
<div class="form-floating col-sm-3 mb-3">
    <input type="text" id="format" class="form-control" />
    <label for="format">Format</label>
</div>
<button type="button" onclick="generateJumble();" class="btn btn-primary">Go!</button>
<button type="button" onclick="removeLetters();" class="btn btn-secondary">Remove</button>
<button type="button" onclick="check();" class="btn btn-secondary">Check</button>
<button type="button" onclick="findWordMatchingPattern();" class="btn btn-secondary">Find Matching Words</button>
<div id="container" class="container">
</div>
<ul id="word-list"></ul>
</body>
</html>
